services:
  api:
    build:
      context: ./src/API
      dockerfile: Dockerfile
    image: landalf-api:latest
    container_name: api
    environment:
      - ASPNETCORE_URLS=http://+:8080
      - Cors:FrontendUrl=http://localhost:8080
    ports:
      - "5000:8080"   # Host 5000 -> Container HTTP 8080
      #- "5001:8081"   # Host 5001 -> Container HTTPS 8081
    volumes:
      - api-data:/app/LANdalf_Data:rw
    user: root
    command: ["/bin/sh", "-c", "mkdir -p /app/LANdalf_Data && chown -R $(id -u):$(id -g) /app/LANdalf_Data || true; exec dotnet API.dll"]
    restart: unless-stopped

  ui:
    build:
      context: ./src/UI
      dockerfile: Dockerfile
    image: landalf-ui:latest
    container_name: ui
    ports:
      - "8080:80"     # Host 8080 -> nginx 80
    depends_on:
      - api
    restart: unless-stopped

volumes:
  api-data: